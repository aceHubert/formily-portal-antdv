{"version":3,"file":"menu.js","sourceRoot":"lib/","sources":["navbar/menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { defineComponent, h, ref, watch } from 'vue-demi'\nimport { Menu } from 'ant-design-vue'\nimport { stylePrefix } from '../__builtins__/configs'\nimport { navigateTo } from '../__builtins__/shared'\n\nexport interface MenuItem {\n  key: string | number\n  text: string\n  linkUrl?: string\n  replace?: boolean\n  children?: Array<Omit<MenuItem, 'children'>>\n}\n\nexport interface RemoteNavMenuDataSource {\n  url: string\n  mapper: Record<string, string>\n}\n\nexport interface NavMenuProps {\n  dataSource: MenuItem[] | RemoteNavMenuDataSource\n  theme?: 'light' | 'dark'\n  router?: any\n}\n\nexport const NavMenu = defineComponent<NavMenuProps>({\n  name: 'NavMenu',\n  emits: ['click'],\n  props: {\n    dataSource: { type: [Array, Object], required: true },\n    theme: String,\n    router: Object,\n  },\n  setup(props, { emit }) {\n    const prefixCls = `${stylePrefix}-nav-menu`\n\n    let flatMenus: Array<Omit<MenuItem, 'children'>> = []\n    const itemsRef = ref<MenuItem[]>([])\n\n    const createFlatMenu = (\n      menus: MenuItem[],\n      flatMenus: Array<Omit<MenuItem, 'children'>> = []\n    ) => {\n      menus.map(({ children, ...rest }) => {\n        flatMenus.push(rest)\n        children?.length && createFlatMenu(children, flatMenus)\n      })\n\n      return flatMenus\n    }\n\n    watch(\n      () => props.dataSource,\n      (value) => {\n        if (Array.isArray(value)) {\n          itemsRef.value = value\n          flatMenus = createFlatMenu(value)\n        } else {\n          // TODO: request from remote\n        }\n      },\n      { immediate: true }\n    )\n\n    return () => {\n      const items = itemsRef.value\n      const { theme = 'light' } = props\n\n      const renderMenuItem = function renderMenuItem(menu: MenuItem) {\n        return h(\n          Menu.Item,\n          {\n            key: menu.key,\n          },\n          [h('span', menu.text)]\n        )\n      }\n\n      return h(\n        Menu,\n        {\n          class: prefixCls,\n          props: {\n            theme,\n            mode: 'horizontal',\n          },\n          on: {\n            click: ({ key }: { key: string | number }) => {\n              const menu = flatMenus.find((menu) => menu.key === key)\n              menu?.linkUrl &&\n                navigateTo(menu.linkUrl, {\n                  replace: menu.replace,\n                  router: props.router,\n                })\n              emit('click', key)\n            },\n          },\n        },\n        items.map((menu) =>\n          menu.children?.length\n            ? h(\n                Menu.SubMenu,\n                {\n                  key: menu.key,\n                },\n                [\n                  h('span', { slot: 'title' }, menu.text),\n                  menu.children.map((child) => renderMenuItem(child)),\n                ]\n              )\n            : [renderMenuItem(menu)]\n        )\n      )\n    }\n  },\n})\n\nexport default NavMenu\n"]}