{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["banner/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { defineComponent, h, ref, watch } from 'vue-demi'\nimport { Carousel } from 'ant-design-vue'\nimport { stylePrefix } from '../__builtins__/configs'\nimport { parseStyleUnit } from '../__builtins__/shared'\n\n// Types\nimport type { VNode } from 'vue-demi'\nimport type { RemoteDataSource } from '../__builtins__/shared'\n\nexport interface BannerItem {\n  key: string | number\n  imageUrl: string\n  linkUrl?: string\n}\n\nexport interface RemoteBannerDataSource extends RemoteDataSource {}\n\nexport interface BannerProps {\n  /**\n   * 默认显示的dataSource中key的下标，默认：0\n   */\n  defaultKey?: BannerItem['key']\n  /**\n   * 数据源\n   * TODO: remote dataSource and dataMapper\n   */\n  dataSource: BannerItem[] | RemoteBannerDataSource\n  /**\n   * 显示的高度(当不设置高度时以 img 标签渲染出图片实际调试，否则按背景平铺)\n   */\n  height?: string | number\n  /**\n   * 自动播放，默认：dataSource.length > 1\n   */\n  autoplay?: boolean\n  /**\n   * 自定义item class\n   */\n  itemClass: string\n}\n\ntype onChange = (key: string | number) => void\ntype onItemClick = (item: BannerItem) => void\n\nexport const Banner = defineComponent<BannerProps>({\n  name: 'Banner',\n  inheritAttrs: false,\n  emit: ['change'],\n  props: {\n    defaultKey: [String, Number],\n    dataSource: { type: [Array, Object], required: true },\n    height: [String, Number],\n    autoplay: [Boolean],\n  },\n  setup(props, { attrs, emit }) {\n    const prefixCls = `${stylePrefix}-banner`\n    const itemsRef = ref<BannerItem[]>([])\n\n    watch(\n      () => props.dataSource,\n      (value) => {\n        if (Array.isArray(value)) {\n          itemsRef.value = value\n        } else {\n          // TODO: request from remote\n        }\n      },\n      { immediate: true }\n    )\n\n    let initialSlide = 0\n    if (\n      props.defaultKey &&\n      (initialSlide = itemsRef.value.findIndex(\n        ({ key }) => key === props.defaultKey\n      )) < 0\n    ) {\n      initialSlide = 0\n    }\n\n    return () => {\n      const items = itemsRef.value\n      const { autoplay = items.length > 1, height } = props\n\n      const renderItems = (): VNode[] => {\n        if (height) {\n          return itemsRef.value.map((item) =>\n            h('a', {\n              class: `${prefixCls}__item`,\n              style: {\n                backgroundImage: `url(${item.imageUrl})`,\n                height: parseStyleUnit(height),\n              },\n              domProps: {\n                href: item.linkUrl || 'javascript:;',\n              },\n              on: {\n                click: () => {\n                  ;(attrs.onItemClick as onItemClick)?.(item)\n                  emit('itemClick', item)\n                },\n              },\n            })\n          )\n        } else {\n          return itemsRef.value.map((item) =>\n            h(\n              'a',\n              {\n                class: [`${prefixCls}__item`, props.itemClass],\n                domProps: {\n                  href: item.linkUrl || 'javascript:;',\n                },\n                on: {\n                  click: () => {\n                    ;(attrs.onItemClick as onItemClick)?.(item)\n                    emit('itemClick', item)\n                  },\n                },\n              },\n              [\n                h('img', {\n                  domProps: {\n                    src: item.imageUrl,\n                    alt: item.imageUrl,\n                  },\n                }),\n              ]\n            )\n          )\n        }\n      }\n\n      return h(\n        Carousel,\n        {\n          class: prefixCls,\n          props: {\n            ...attrs,\n            initialSlide,\n            autoplay,\n            afterChange: (current: number) => {\n              ;(attrs.onChange as onChange)?.(items[current].key)\n              emit('change', items[current].key)\n            },\n          },\n        },\n        renderItems()\n      )\n    }\n  },\n})\n\nexport default Banner\n"]}